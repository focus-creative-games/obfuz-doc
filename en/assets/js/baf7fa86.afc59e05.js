"use strict";(self.webpackChunkobfuz=self.webpackChunkobfuz||[]).push([[3448],{7589:(e,l,i)=>{i.r(l),i.d(l,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"manual/hybridclr/polymorphic-dll","title":"Polymorphic DLL Files","description":"By default, Assembly.Load requires passing in standard dll files, meaning malicious crackers can obtain complete original dll files or load malicious third-party dlls, creating significant security risks for developers.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/manual/hybridclr/polymorphic-dll.md","sourceDirName":"manual/hybridclr","slug":"/manual/hybridclr/polymorphic-dll","permalink":"/en/docs/manual/hybridclr/polymorphic-dll","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/manual/hybridclr/polymorphic-dll.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Working with HybridCLR","permalink":"/en/docs/manual/hybridclr/work-with-hybridclr"},"next":{"title":"xLua","permalink":"/en/docs/manual/xlua"}}');var r=i(4848),t=i(8453);const s={},o="Polymorphic DLL Files",a={},d=[{value:"Features",id:"features",level:2},{value:"Settings",id:"settings",level:2},{value:"codeGenerationSecretKey",id:"codegenerationsecretkey",level:3},{value:"disableLoadStandardDll",id:"disableloadstandarddll",level:3},{value:"Making HybridCLR Support Polymorphic DLLs",id:"making-hybridclr-support-polymorphic-dlls",level:2},{value:"Generate Polymorphic DLLs",id:"generate-polymorphic-dlls",level:2}];function c(e){const l={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.header,{children:(0,r.jsx)(l.h1,{id:"polymorphic-dll-files",children:"Polymorphic DLL Files"})}),"\n",(0,r.jsxs)(l.p,{children:["By default, ",(0,r.jsx)(l.code,{children:"Assembly.Load"})," requires passing in standard dll files, meaning malicious crackers can obtain complete original dll files or load malicious third-party dlls, creating significant security risks for developers.\nEven if dll files are encrypted, malicious crackers can still dump complete original dll files by hooking the ",(0,r.jsx)(l.code,{children:"Assembly.Load"})," entry point."]}),"\n",(0,r.jsx)(l.p,{children:"Obfuz effectively counters such dll dumping or tampering behaviors by supporting polymorphic dll files."}),"\n",(0,r.jsx)(l.h2,{id:"features",children:"Features"}),"\n",(0,r.jsxs)(l.ul,{children:["\n",(0,r.jsx)(l.li,{children:"Brand new dll file structure that can no longer be opened by conventional dll decompilation tools like ILSpy."}),"\n",(0,r.jsx)(l.li,{children:"Brand new metadata structure that can no longer be easily restored to original CLI metadata data."}),"\n",(0,r.jsxs)(l.li,{children:[(0,r.jsx)(l.strong,{children:"Supports randomization of dll file structure and metadata structure"}),", with dozens of metadata structures and hundreds of metadata fields completely randomized. Each developer's final dll structure is different, dramatically increasing the cracking cost for malicious crackers."]}),"\n",(0,r.jsxs)(l.li,{children:["Supports prohibiting loading of standard dll files, preventing loading of malicious dlls through ",(0,r.jsx)(l.code,{children:"Assembly.Load"})," calls."]}),"\n"]}),"\n",(0,r.jsx)(l.h2,{id:"settings",children:"Settings"}),"\n",(0,r.jsxs)(l.p,{children:[(0,r.jsx)(l.code,{children:"ObfuzSettings.PolymorphicDllSettings"})," contains polymorphic dll related settings, detailed documentation can be found in ",(0,r.jsx)(l.a,{href:"../configuration",children:"Configuration"}),"."]}),"\n",(0,r.jsx)(l.admonition,{type:"tip",children:(0,r.jsxs)(l.p,{children:["HybridCLR supports custom dll file structures starting from v8.4.0. To enable polymorphic dll support, HybridCLR version must be at least ",(0,r.jsx)(l.code,{children:"v8.4.0"}),"."]})}),"\n",(0,r.jsx)(l.h3,{id:"codegenerationsecretkey",children:"codeGenerationSecretKey"}),"\n",(0,r.jsxs)(l.p,{children:["codeGenerationSecretKey is the randomization key used when generating polymorphic dll code. ",(0,r.jsx)(l.strong,{children:"Please do not use the default value"}),", use a length of 10 or more with complex character combinations."]}),"\n",(0,r.jsxs)(l.p,{children:["Modifying codeGenerationSecretKey will generate completely different dll file structures. This file structure is solidified in binary code and completely fixed after releasing the App.\n",(0,r.jsx)(l.strong,{children:"Do not"})," modify this value when releasing hot update dlls, as it will cause loading failures!"]}),"\n",(0,r.jsx)(l.p,{children:"It is recommended to change this value when releasing new App packages. If multiple versions of App packages exist simultaneously and you want to use the same polymorphic dll, please keep codeGenerationSecretKey consistent."}),"\n",(0,r.jsx)(l.h3,{id:"disableloadstandarddll",children:"disableLoadStandardDll"}),"\n",(0,r.jsx)(l.p,{children:"Whether to prohibit loading standard structure dlls. After enabling this option, Assembly.Load or RuntimeApi.LoadMetadataForAOTAssembly must pass in polymorphic dlls. If standard dlls are passed in, an error will be returned."}),"\n",(0,r.jsx)(l.p,{children:"Enabling this option can effectively counter malicious crackers injecting third-party dlls at runtime, because it's very difficult for them to construct dlls that conform to polymorphic dll structures, dramatically increasing injection costs."}),"\n",(0,r.jsx)(l.h2,{id:"making-hybridclr-support-polymorphic-dlls",children:"Making HybridCLR Support Polymorphic DLLs"}),"\n",(0,r.jsxs)(l.p,{children:["The call to generate polymorphic dll code has been inserted into the ",(0,r.jsx)(l.code,{children:"HybridCLR/ObfuzExtension/GenerateAll"})," command. As long as ",(0,r.jsx)(l.code,{children:"PolymorphicDllSettings.enable"})," is true, related code will be automatically generated during ",(0,r.jsx)(l.code,{children:"GenerateAll"}),"."]}),"\n",(0,r.jsxs)(l.p,{children:["If you want to actively call generation, you can call the ",(0,r.jsx)(l.code,{children:"ObfuscateUtil::GeneratePolymorphicCodes(string libil2cppDir)"})," function."]}),"\n",(0,r.jsx)(l.h2,{id:"generate-polymorphic-dlls",children:"Generate Polymorphic DLLs"}),"\n",(0,r.jsxs)(l.p,{children:["Call ",(0,r.jsx)(l.code,{children:"ObfuscateUtil::GeneratePolymorphicDll(string originalDllPath, string outputDllPath)"})," to generate polymorphic dlls."]}),"\n",(0,r.jsxs)(l.p,{children:["Regular hot update assemblies, DHE assemblies, and ",(0,r.jsx)(l.strong,{children:"supplemental metadata assemblies"})," can all use polymorphic dlls."]})]})}function u(e={}){const{wrapper:l}={...(0,t.R)(),...e.components};return l?(0,r.jsx)(l,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,l,i)=>{i.d(l,{R:()=>s,x:()=>o});var n=i(6540);const r={},t=n.createContext(r);function s(e){const l=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function o(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(t.Provider,{value:l},e.children)}}}]);