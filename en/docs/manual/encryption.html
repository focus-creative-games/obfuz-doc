<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-manual/encryption" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Encryption | Obfuz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.obfuz.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.obfuz.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.obfuz.com/en/docs/manual/encryption"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Encryption | Obfuz"><meta data-rh="true" name="description" content="Encryption is the core mechanism of Obfuz. Most Obfuscation Passes are related to encryption for the following reasons:"><meta data-rh="true" property="og:description" content="Encryption is the core mechanism of Obfuz. Most Obfuscation Passes are related to encryption for the following reasons:"><link data-rh="true" rel="icon" href="/en/img/favicon.png"><link data-rh="true" rel="canonical" href="https://www.obfuz.com/en/docs/manual/encryption"><link data-rh="true" rel="alternate" href="https://www.obfuz.com/docs/manual/encryption" hreflang="zh"><link data-rh="true" rel="alternate" href="https://www.obfuz.com/en/docs/manual/encryption" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.obfuz.com/docs/manual/encryption" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8MDOTENYMF-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Obfuz" href="/en/opensearch.xml"><link rel="stylesheet" href="/en/assets/css/styles.c890b8c4.css">
<script src="/en/assets/js/runtime~main.4707c386.js" defer="defer"></script>
<script src="/en/assets/js/main.d2fc5910.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/en/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.png" alt="Obfuz Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.png" alt="Obfuz Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Obfuz</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/manual/encryption" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li><li><a href="/en/docs/manual/encryption" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/focus-creative-games/obfuz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/en/docs/manual">Manual</a><button aria-label="Collapse sidebar category &#x27;Manual&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/menu">Editor Menu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/assembly">Assemblies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/manual/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/method-body-obfuscation">Method Body Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/obfuscation-pass">Obfuscation Pass</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/customattributes">Obfuz CustomAttributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/obfuscation-instincts">Obfuscation Instincts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/symbol-obfuscation">Symbol Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/const-encryption">Constant Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/remove-const-field">Remove Const Fields</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/field-encryption">Field Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/eval-stack-obfuscation">Eval Stack Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/expr-obfuscation">Expression Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/call-obfuscation">Function Call Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/control-flow-obfuscation">Control Flow Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/watermark">Code Watermark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/garbage-code-generation">Garbage Code Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/build-pipeline">Obfuscation During Build Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/run-obfuscation-standalonely">Run Obfuscation Standalone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/incremental-obfuscation-and-hotupdate">Incremental Obfuscation and Hot Update</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/serialization">Serialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/reflection">Reflection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/impact-dll-size">Impact on Assembly Size</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/en/docs/manual/hybridclr">HybridCLR</a><button aria-label="Expand sidebar category &#x27;HybridCLR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/en/docs/manual/xlua">xLua</a><button aria-label="Expand sidebar category &#x27;xLua&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/manual/deobfuscate-stacktrace">Deobfuscate Stack Trace</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/docs/help">Help</a><button aria-label="Expand sidebar category &#x27;Help&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/help/releaselog">Release Log</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/manual"><span itemprop="name">Manual</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Encryption</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Encryption</h1></header>
<p>Encryption is the core mechanism of Obfuz. Most Obfuscation Passes are related to encryption for the following reasons:</p>
<ul>
<li>Features like constant encryption that directly involve data encryption functionality inevitably need to use encryption-related mechanisms</li>
<li>Obfuscation passes like function call obfuscation use delayed (i.e., when executing that code for the first time) decryption of some key parameters to prevent offline cracking</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iencryptor">IEncryptor<a href="#iencryptor" class="hash-link" aria-label="Direct link to IEncryptor" title="Direct link to IEncryptor">​</a></h2>
<p>Obfuz builds the entire encryption mechanism on a basic encryption interface IEncryptor.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Obfuz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public interface IEncryptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int OpCodeCount { get; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        void EncryptBlock(byte[] data, int ops, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        void DecryptBlock(byte[] data, int ops, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int Encrypt(int value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int Decrypt(int value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long Encrypt(long value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long Decrypt(long value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float Encrypt(float value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float Decrypt(float value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        double Encrypt(double value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        double Decrypt(double value, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] Encrypt(byte[] value, int offset, int length, int opts, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] Decrypt(byte[] value, int offset, int byteLength, int ops, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] Encrypt(string value, int ops, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string DecryptString(byte[] value, int offset, int stringBytesLength, int ops, int salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Any encryption or decryption operation involves 3 pieces of data:</p>
<ul>
<li>data: original data or encrypted data</li>
<li>ops: encryption or decryption operations</li>
<li>salt: additional random parameter</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="encryption-instruction-group-ops">Encryption Instruction Group ops<a href="#encryption-instruction-group-ops" class="hash-link" aria-label="Direct link to Encryption Instruction Group ops" title="Direct link to Encryption Instruction Group ops">​</a></h2>
<p>To increase cracking difficulty, Obfuz does not use fixed encryption code, but pre-generates a fixed MaxOpCount number (default 256, customizable) of encryption instructions.
For each encryption object, a set of random encryption (or decryption) instructions op1, op2, .. opn is generated.</p>
<p>To simplify implementation while avoiding excessive performance impact, we limit encryption operations to no more than 4, which can generally be encoded as an integer, i.e., the <code>int ops</code> parameter in Encrypt or Decrypt functions.</p>
<p>The final ops calculation method is as follows:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int GenerateOps(uint[] opArr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint ops = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (int i = opArr.Length - 1; i &gt;= 0; i--)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ops *= MaxOpCount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ops |= opArr[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return (int)ops;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since decryption is the reverse operation of encryption, using reverse encoding ops algorithm facilitates runtime decryption to decode ops in forward order, improving runtime efficiency, as runtime decryption operations are much more frequent than encryption operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="encryptionvm">EncryptionVM<a href="#encryptionvm" class="hash-link" aria-label="Direct link to EncryptionVM" title="Direct link to EncryptionVM">​</a></h2>
<p>The encryption service in Obfuz needs to meet the following requirements:</p>
<ol>
<li>Implement all interfaces in IEncryptor.</li>
<li>Support encryption instruction group ops mechanism.</li>
<li>Polymorphism, i.e., each developer can generate unique encryption code, increasing cracking difficulty.</li>
</ol>
<p>We achieve these goals by generating EncryptionVM based on a randomization seed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="encryption-instruction-set">Encryption Instruction Set<a href="#encryption-instruction-set" class="hash-link" aria-label="Direct link to Encryption Instruction Set" title="Direct link to Encryption Instruction Set">​</a></h3>
<p>To support the encryption instruction group ops mechanism, EncryptionVM needs to contain a fixed set of encryption instructions.</p>
<p>EncryptionVM supports the following encryption instruction primitives:</p>
<ul>
<li>Add</li>
<li>Multiple</li>
<li>Xor</li>
<li>BitRotate</li>
<li>AddRotateXor</li>
<li>AddXorRotate</li>
<li>MultipleRotateXor</li>
<li>MultipleXorRotate</li>
<li>XorAddRotate</li>
<li>XorMultipleRotate</li>
</ul>
<p>Each encryption instruction primitive has some randomization parameters, ensuring that every encryption instruction is different.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-encryption-instruction-set">Generating Encryption Instruction Set<a href="#generating-encryption-instruction-set" class="hash-link" aria-label="Direct link to Generating Encryption Instruction Set" title="Direct link to Generating Encryption Instruction Set">​</a></h3>
<p>Obfuz uses a deterministic random algorithm to generate the encryption instruction set based on an initial random seed.</p>
<ul>
<li><code>EncryptionVMSettings.CodeGenerationSecretKey</code> configures this initial randomization seed.</li>
<li><code>EncryptionVMSettings.EncryptionOpCodeCount</code> configures the number of instructions in the encryption instruction set.</li>
</ul>
<p>EncryptionOpCodeCount must be a power of 2 (like 64, 128, 256, 1024), with a default value of 256. The minimum value is 64, and while there&#x27;s no maximum limit, it&#x27;s not recommended to exceed 1024 as it would cause the generated <code>GeneratedEncryptionVirtualMachine</code> class code to be too large.</p>
<p>The generation algorithm randomly selects the encryption instruction primitive used by each instruction and the randomization parameters for that encryption primitive.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-encryptionvm-code">Generating EncryptionVM Code<a href="#generating-encryptionvm-code" class="hash-link" aria-label="Direct link to Generating EncryptionVM Code" title="Direct link to Generating EncryptionVM Code">​</a></h3>
<p>Run the menu <code>Obfuz/GenerateEncryptionVM</code> to generate encryption virtual machine code. Configure the output code file path for the <code>GeneratedEncryptionVirtualMachine</code> class in <code>EncryptionVMSettings.CodeOutputPath</code>.
The default generated code file is <code>Assets/Obfuz/GeneratedEncryptionVirtualMachine.cs</code>.</p>
<p>Generally, GeneratedEncryptionVirtualMachine needs to be placed in AOT assemblies. This not only improves encryption performance but also takes advantage of il2cpp&#x27;s characteristic of compiling code to machine instructions, increasing cracking difficulty.</p>
<p>If there are no AOT obfuscated assemblies, GeneratedEncryptionVirtualMachine can also be placed in hot update assemblies, achieving maximum flexibility with different encryption virtual machines for each hot update code release. However, placing it in hot update code not only leads to poor encryption performance but is also easily reverse-engineered, so this is not recommended.</p>
<p>It&#x27;s recommended to modify <code>CodeGenerationSecretKey</code> each time a new main package is released to generate a brand new EncryptionVM, increasing cracking difficulty. If code hot update technology is used and <code>GeneratedEncryptionVirtualMachine</code> is in AOT assemblies, do not modify <code>CodeGenerationSecretKey</code> when releasing hot update code, otherwise it will cause decryption code errors in obfuscated hot update assemblies!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="encryptionservice">EncryptionService<a href="#encryptionservice" class="hash-link" aria-label="Direct link to EncryptionService" title="Direct link to EncryptionService">​</a></h2>
<p>Obfuz provides unified encryption and decryption services through the EncryptionService class. Its implementation is simple, with an <code>IEncryptor _encryptor</code> variable that implements specific encryption and decryption services by forwarding calls to interfaces in <code>_encryptor</code>.</p>
<p>Partial code excerpt from EncryptionService:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Obfuz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class EncryptionService&lt;T&gt; where T : IEncryptionScope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // for compatibility with Mono because Mono will raise FieldAccessException when try access private field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static IEncryptor _encryptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static IEncryptor Encryptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            get =&gt; _encryptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            set { _encryptor = value; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static void EncryptBlock(byte[] data, int ops, int salt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _encryptor.EncryptBlock(data, ops, salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static void DecryptBlock(byte[] data, int ops, int salt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _encryptor.DecryptBlock(data, ops, salt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Taking constant encryption as an example, <code>int a = 5;</code> becomes <code>int a = Obfuz.EncryptionService&lt;Obfuz.DefaultStaticSecretScope&gt;.Decrypt(11231312, 98978274, 2342342)</code> after constant encryption.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="initializing-encryptor">Initializing Encryptor<a href="#initializing-encryptor" class="hash-link" aria-label="Direct link to Initializing Encryptor" title="Direct link to Initializing Encryptor">​</a></h3>
<p>Generally, EncryptionService.Encryptor is assigned a <code>GeneratedEncryptionVirtualMachine</code> instance, example code as follows:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [ObfuzIgnore]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.AfterAssembliesLoaded)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static void SetUpStaticSecret()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EncryptionService&lt;DefaultStaticEncryptionScope&gt;.Encryptor = new GeneratedEncryptionVirtualMachine(Resources.Load&lt;TextAsset&gt;(&quot;Obfuz/defaultStaticSecretKey&quot;).bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ... Initialize other EncryptionScopes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>GeneratedEncryptionVirtualMachine requires a 1024-byte <code>byte[]</code> key parameter. Since this key is quite long, instead of generating it directly, it&#x27;s calculated from an initial key string through a hash algorithm.</p>
<p>Obfuz calls the <code>Obfuz.Utils.KeyGenerator::GenerateKey</code> function to generate keys, code as follows:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace Obfuz.Utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class KeyGenerator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static byte[] GenerateKey(string initialString, int keyLength)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] initialBytes = Encoding.UTF8.GetBytes(initialString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using (var sha512 = SHA512.Create())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] hash = sha512.ComputeHash(initialBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] key = new byte[keyLength];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                int bytesCopied = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                while (bytesCopied &lt; key.Length)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (bytesCopied &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // Hash the previous hash value again to generate more data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        hash = sha512.ComputeHash(hash);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int bytesToCopy = Math.Min(hash.Length, key.Length - bytesCopied);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Buffer.BlockCopy(hash, 0, key, bytesCopied, bytesToCopy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    bytesCopied += bytesToCopy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="encryptionscope">EncryptionScope<a href="#encryptionscope" class="hash-link" aria-label="Direct link to EncryptionScope" title="Direct link to EncryptionScope">​</a></h2>
<p>Game projects want to use multiple keys to increase cracking difficulty. Also, if code hot updates are used in a project, it&#x27;s very likely that hot update code should use different encryption keys from AOT, and these keys should be loadable after hot updates are completed, not necessarily at startup.
Obfuz implements this functionality through EncryptionScope.</p>
<p>By setting different <code>IEncryptor</code> instances for different <code>EncryptionService&lt;{EncryptionScope}&gt;</code> at runtime, multiple different keys can be used, example code as follows:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [ObfuzIgnore]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.AfterAssembliesLoaded)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static void SetUpStaticSecret()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EncryptionService&lt;DefaultStaticEncryptionScope&gt;.Encryptor = new GeneratedEncryptionVirtualMachine(Resources.Load&lt;TextAsset&gt;(&quot;Obfuz/defaultStaticSecretKey&quot;).bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set Encryptors for other static EncryptionScopes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static void SetUpDynamicSecret()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EncryptionService&lt;DefaultDynamicEncryptionScope&gt;.Encryptor = new GeneratedEncryptionVirtualMachine(Resources.Load&lt;TextAsset&gt;(&quot;Obfuz/defaultDynamicSecretKey&quot;).bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set Encryptors for other dynamic EncryptionScopes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each assembly can only correspond to one EncryptionScope, i.e., you cannot use EncryptionScopeA for part of the code in an assembly and EncryptionScopeB for another part. Each obfuscated assembly uses <code>DefaultStaticEncryptionScope</code> by default,
i.e., uses the <code>SecretSettings.DefaultStaticSecretKey</code> key. If an assembly name is added to the <code>SecretSettings.AssembliesUseDynamicSecretKeys</code> list, that assembly uses <code>DefaultDynamicEncryptionScope</code>.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><code>EncryptionService&lt;DefaultStaticEncryptionScope&gt;.Encryptor</code> must be initialized with DefaultStaticSecretKey,
<code>EncryptionService&lt;DefaultDynamicEncryptionScope&gt;.Encryptor</code> must be initialized with DefaultDynamicSecretKey,
these two cannot be mixed!</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="secret-key">Secret Key<a href="#secret-key" class="hash-link" aria-label="Direct link to Secret Key" title="Direct link to Secret Key">​</a></h2>
<p>The current version only supports two keys: defaultStaticSecretKey and defaultDynamicSecretKey. Future versions will support any number of keys.</p>
<p><code>DefaultStaticSecretKey</code> and <code>DefaultDynamicSecretKey</code> can be configured in <code>ObfuzSettings.SecretSettings</code>.</p>
<p>The menu <code>Obfuz/GenerateSecretKey</code> will generate defaultStaticSecretKey.bytes and defaultDynamicSecretKey.bytes files for these two keys. The output directory for key files can be configured in <code>SecretSettings.SecretKeyOutputPath</code>.</p>
<p>If some AOT assemblies are obfuscated, since code in AOT assemblies may be executed very early, if Encryptor is not set for their corresponding <code>EncryptionService&lt;{EncryptionScope}&gt;</code> before executing obfuscated or encrypted code in these assemblies,
runtime exceptions will occur. It&#x27;s recommended to execute <code>EncryptionService&lt;{EncryptionScope}&gt;.Encryptor</code> initialization code as early as possible. A reasonable approach is to use <code>[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.AfterAssembliesLoaded)]</code>
to run EncryptionService initialization code after CLR (il2cpp or mono) runtime loads all assemblies.</p>
<p>Obviously, <code>SetUpStaticSecret</code> code should not be obfuscated, as EncryptionService is not yet initialized at that time, which would lead to infinite recursion. However, <code>SetUpDynamicSecret</code> can be obfuscated, so it&#x27;s generally called only after certain conditions are met (such as after hot updates are completed).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="salt">salt<a href="#salt" class="hash-link" aria-label="Direct link to salt" title="Direct link to salt">​</a></h2>
<p>The salt in Encrypt or Decrypt is a randomly generated parameter with a value range of <code>[int.MinValue, int.MaxValue]</code>. It serves as an additional parameter to increase the complexity of encryption and decryption operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="secretsettingsrandomseed">SecretSettings.RandomSeed<a href="#secretsettingsrandomseed" class="hash-link" aria-label="Direct link to SecretSettings.RandomSeed" title="Direct link to SecretSettings.RandomSeed">​</a></h2>
<p>RandomSeed does not directly participate in the encryption/decryption process, but it&#x27;s used to generate random ops, salt, and other scenarios requiring randomization.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/manual/encryption.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/manual/assembly"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Assemblies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/manual/method-body-obfuscation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Method Body Obfuscation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#iencryptor" class="table-of-contents__link toc-highlight">IEncryptor</a></li><li><a href="#encryption-instruction-group-ops" class="table-of-contents__link toc-highlight">Encryption Instruction Group ops</a></li><li><a href="#encryptionvm" class="table-of-contents__link toc-highlight">EncryptionVM</a><ul><li><a href="#encryption-instruction-set" class="table-of-contents__link toc-highlight">Encryption Instruction Set</a></li><li><a href="#generating-encryption-instruction-set" class="table-of-contents__link toc-highlight">Generating Encryption Instruction Set</a></li><li><a href="#generating-encryptionvm-code" class="table-of-contents__link toc-highlight">Generating EncryptionVM Code</a></li></ul></li><li><a href="#encryptionservice" class="table-of-contents__link toc-highlight">EncryptionService</a><ul><li><a href="#initializing-encryptor" class="table-of-contents__link toc-highlight">Initializing Encryptor</a></li></ul></li><li><a href="#encryptionscope" class="table-of-contents__link toc-highlight">EncryptionScope</a></li><li><a href="#secret-key" class="table-of-contents__link toc-highlight">Secret Key</a></li><li><a href="#salt" class="table-of-contents__link toc-highlight">salt</a></li><li><a href="#secretsettingsrandomseed" class="table-of-contents__link toc-highlight">SecretSettings.RandomSeed</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">入门</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">相关项目</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/focus-creative-games/hybridclr" target="_blank" rel="noopener noreferrer" class="footer__link-item">HybridCLR<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/focus-creative-games/luban" target="_blank" rel="noopener noreferrer" class="footer__link-item">Luban<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Code Philosophy, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>